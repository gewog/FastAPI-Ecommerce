"""
Модуль для тестирования FastAPI-приложения.

Этот модуль содержит набор тестов для проверки корректности работы API-эндпоинтов.
Используются как асинхронные, так и синхронные тесты с помощью библиотек `pytest`,
`httpx` и `TestClient` из FastAPI.

Асинхронные тесты выполняются с использованием `httpx.AsyncClient` и `ASGITransport`,
что позволяет тестировать асинхронные эндпоинты без запуска реального сервера.

Синхронные тесты (закомментированы) используют `TestClient` из FastAPI для упрощённого
тестирования синхронных эндпоинтов.

Примеры тестов:
- Проверка корневого эндпоинта `/` на корректный статус-код и тело ответа.
"""

from sqlalchemy.ext.asyncio import AsyncSession
from app.backend.db import session


async def get_session() -> AsyncSession:
    """
    Асинхронная функция зависимости для FastAPI, предоставляющая сессию SQLAlchemy.
    Создаёт новую асинхронную сессию SQLAlchemy и управляет её жизненным циклом.
    Сессия автоматически закрывается после завершения запроса.
    """
    async with session() as ss:
        try:
            yield ss
        finally:
            await ss.close()  # Закрывает сессию при ошибке
